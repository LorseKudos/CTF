from collections import Counter
from Crypto.Util.number import *
import sys
import random
import sympy

flag = open('flag.txt', 'rb').read()
print("Loading... this may take a while.")
p, q = 530706432493608164887607239183229184027307780429966723055848011671015501477182352702367742049736546318350860275477764490162402477631686362912536018621122507140030551446488773235488645716488459905071038567303732267579158391642465170316707337910694368936818681309464997771356548221265604282157265240518544407555950007769396392914455719394821708675924395095729018750912358090249705098078706031235404901451918362659496783164865683628652815477046354583733833710377052630401483291060151313263271160711701125797512046464975294725839360257196279310193242353081516831450615662330336006652987250992156902511579785190307465148384230759121039856419755282915404660850517043271138085873247251915813391178871030102277547512311408890433410136264874463223738179000653435967076777648831114158412035499862470219441611133213633018699749526126190038244378457431505254967567875737976780412463262190216692189596298017394817091434261780563562647982818476646226418495517180828946695491026260645159843253301491494977539313719405483620636253696792354449470910175689678204391491936147565438622129240850736472338682011887423947917060526515581587529760366719412874287235723897886270865944132395167899677934461167911902232506601593205925325186290814265765398859959, 736385201325045657703910333728295808930420183472926871003590964569781039107276547078590624070053207764051336544335638186728716458994726915455170554316849698917357314812896260546794118338854251492956469403989425813252311952901332185356983758344168450082477894905200637118436530133194814092540232130775604724443610311201996816169284669509934765361216200205648368489897123791716821403573409535887683525367882491683445984449432233946529857692268634145026921523086180868011838013234940742493626051756294535257294662560227133906537604868159151506108871165553754492901727602733780510215277363824587027822887160685321153336197576254809697536790269007254596551831043976121104432576517803643467515897140543517095383330211762786962639378135864485049964112449666859166880582286073083113178221687117504298408226161213003656458453888943593864507188980504113062452989900463067636468741622975862179748844741746277748000987455771102262024788968934699377201723352508808232997363794165290878264067848230791803932912409171899140759435659232302566877413895797988673638331357360950028455154329597707986498720254952601894015086054898467990499462082879333381045427841180893583066320923158282942350532160737249258320360589766039709848642462624301424668448997
e = 0x10001
n = p*q
m = random.randrange(0, n)
c = pow(m, e, n)
d = sympy.mod_inverse(e, (p-1)*(q-1))


def menu(guesses):
    print()
    print("1. Source")
    print("2. Public key")
    print("3. Decrypt")
    print("4. Play")
    print("\nYou have "+str(guesses)+" guesses left.")
    choice = input(": ").strip()
    if choice == "1":
        f = open(__file__)
        print()
        print(f.read())
        print()
        menu(guesses)
    elif choice == "2":
        print("\nn = "+str(n))
        print("e = 65537")
        menu(guesses)
    elif choice == "3":
        d_ = int(input("What is the private key?\n: "))
        if (pow(c, d_, n) == m):
            print("Congrats! Here is your flag:")
            print(flag)
            sys.exit()
        else:
            print("\nSorry, that is incorrect.")
            menu(guesses)
    elif choice == "4":
        if guesses == 0:
            print("Sorry, you have no more guesses.")
            menu(0)
        else:
            if guesses > 8:
                code = list(hex(p)[2:])
            else:
                code = list(hex(q)[2:])
            guess = input("Make a guess.\n: ")
            while len(guess) != 1024:
                guess = input("Try again.\n: ")
            guess = list(guess)
            a = "".join(["1" if guess[i] == code[i]
                        else "0" for i in range(1024)])
            print(a)
            guesses -= 1
            menu(guesses)
    else:
        print("That is not a valid choice.")
        menu(guesses)


while 1:
    menu(16)
